use gdp_vs_population;

CREATE TABLE pop_2020 AS
SELECT DISTINCT C1.CBSA as cbsa, CTYNAME as ctyname, STATE as state, LSAD as lsad, `COUNTY AND STATE` as county_state, POPESTIMATE2010 as pop2010, POPESTIMATE2011 as pop2011, POPESTIMATE2012 as pop2012, 
POPESTIMATE2013 as pop2013, POPESTIMATE2014 as pop2014, POPESTIMATE2015 as pop2015, POPESTIMATE2016 as pop2016, 
POPESTIMATE2017 as pop2017, POPESTIMATE2018 as pop2018, POPESTIMATE2019 as pop2019, POPESTIMATE2020 AS pop2020
FROM county_population_2010_2020 AS C1
JOIN (
    SELECT DISTINCT CBSA, MAX(POPESTIMATE2020) AS MAXPOP
	FROM county_population_2010_2020
	GROUP BY CBSA
    ) AS C2 ON C1.CBSA = C2.CBSA AND C1.POPESTIMATE2020 = C2.MAXPOP
;